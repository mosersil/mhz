<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://bridge.paymill.com/"></script>
    <script>
        PAYMILL_PUBLIC_KEY = "40433965467839fe8b5288527a260995"; // Insert your Public API Key here
        // Callback for the PayFrame
        var payFrameCallback = function (error) {
            if (error) {
                // Frame could not be loaded, check error object for reason.
                console.log(error.apierror, error.message);
            } else {
                // Frame was loaded successfully and is ready to be used.
                console.log("PayFrame successfully loaded");
                $("#payment-form").show(300);
            }
        }

        var submit = function (event) {
            paymill.createTokenViaFrame({
                amount_int: 1000,
                currency: 'CHF'
            }, function(error, result) {
                // Handle error or process result.
                if (error) {
                    // Token could not be created, check error object for reason.
                    console.log(error.apierror, error.message);
                } else {
                    // Token was created successfully and can be sent to backend.
                    console.log("token has been created")
                    var form = $("#payment-form");
                    var token = result.token;
                    form.append("<input type='hidden' name='token' value='" + token + "'/>");
                    form.get(0).submit();
                }
            });

            return false;
        }


        $(document).ready(function () {
            paymill.embedFrame('credit-card-fields', {
                lang: 'de'
            }, payFrameCallback);
            $("#payment-form").submit(submit);
        });
    </script>
</head>
<body>
<div class="row">
    <form class="payment-form col-lg-5 collapse" id="payment-form" action="/public/api/createpayment" method="POST">
        <input type="hidden" name="amount" value="1000">
        <input type="hidden" name="currency" value="CHF">
        <input type="hidden" name="description" value="Easy Payments Guide!!!">

        <div id="credit-card-fields">
            <!-- Embedded credit card frame will load here -->
        </div>

        <button class='form-control btn btn-success submit-button' type='submit'>Get your "Easy Payments Guide" now for 10 CHF</button>
    </form>
</div>
</body>

</html>